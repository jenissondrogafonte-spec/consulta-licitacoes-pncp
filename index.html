<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Licita√ß√µes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
    <div class="container bg-white p-4 rounded shadow">
        <h2 class="text-primary mb-4">üìä Monitor de Licita√ß√µes - PNCP</h2>
        
        <div class="row g-2 mb-4">
            <div class="col-md-6">
                <input type="text" id="buscaFornecedor" class="form-control" placeholder="üîç Buscar por Fornecedor...">
            </div>
            <div class="col-md-6">
                <input type="text" id="buscaOrgao" class="form-control" placeholder="üîç Buscar por √ìrg√£o...">
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Data</th>
                        <th>√ìrg√£o</th>
                        <th>Licita√ß√£o</th>
                        <th>Fornecedor</th>
                        <th>Itens</th>
                        <th>Total (R$)</th>
                    </tr>
                </thead>
                <tbody id="tabelaDados"></tbody>
            </table>
            <div id="msgStatus" class="text-center p-5 text-muted">Carregando dados...</div>
        </div>
    </div>

    <script>
        // For√ßa o navegador a buscar o arquivo novo
        const url = 'dados.json?v=' + Date.now();

        fetch(url)
            .then(r => r.json())
            .then(data => {
                const status = document.getElementById('msgStatus');
                if (!data || data.length === 0) {
                    status.innerText = "O arquivo dados.json est√° vazio.";
                    return;
                }
                status.style.display = 'none';
                
                // Armazena os dados globalmente
                window.meusDados = data.reverse(); 
                renderizar(window.meusDados);

                // Configura a busca
                document.getElementById('buscaFornecedor').addEventListener('keyup', filtrar);
                document.getElementById('buscaOrgao').addEventListener('keyup', filtrar);
            })
            .catch(e => {
                document.getElementById('msgStatus').innerHTML = "‚ùå Erro ao carregar o arquivo dados.json.";
            });

        function renderizar(lista) {
            const tbody = document.getElementById('tabelaDados');
            tbody.innerHTML = lista.map(item => `
                <tr>
                    <td>${formatarData(item.Data_Homologacao)}</td>
                    <td>${item.Orgao_Codigo || '-'}</td>
                    <td>${item.Num_Licitacao || '-'}</td>
                    <td><strong>${item.Fornecedor || '-'}</strong></td>
                    <td>${item.Itens_Ganhos || '0'}</td>
                    <td class="text-success fw-bold">R$ ${Number(item['Total_Ganho_R$']).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                </tr>
            `).join('');
        }

        function filtrar() {
            const forn = document.getElementById('buscaFornecedor').value.toLowerCase();
            const org = document.getElementById('buscaOrgao').value.toLowerCase();

            const filtrados = window.meusDados.filter(item => {
                const matchForn = (item.Fornecedor || '').toLowerCase().includes(forn);
                const matchOrg = (item.Orgao_Codigo || '').toLowerCase().includes(org);
                return matchForn && matchOrg;
            });
            renderizar(filtrados);
        }

        function formatarData(dataStr) {
            if (!dataStr || dataStr.length !== 8) return dataStr;
            return dataStr.substring(6, 8) + '/' + dataStr.substring(4, 6) + '/' + dataStr.substring(0, 4);
        }
    </script>
</body>
</html>
