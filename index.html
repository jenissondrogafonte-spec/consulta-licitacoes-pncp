<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta PNCP - ComprasNet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        .main-card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 8px 30px rgba(0,0,0,0.05); }
        .filter-label { font-size: 0.75rem; font-weight: 700; color: #6c757d; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .btn-search { background-color: #0056b3; border: none; font-weight: 600; padding: 10px 25px; }
        .btn-search:hover { background-color: #004494; }
        .empty-state { text-align: center; padding: 80px 20px; color: #adb5bd; border: 2px dashed #e9ecef; border-radius: 12px; margin-top: 20px; }
        .table-res { font-size: 0.85rem; }
    </style>
</head>
<body class="p-4">
    <div class="container-fluid main-card">
        <h4 class="text-dark mb-4 fw-bold">üîç Consulta de Preg√µes (Padr√£o ComprasNet)</h4>
        
        <div class="row g-3 mb-4 align-items-end">
            <div class="col-md-3">
                <label class="filter-label">Fornecedor ou CNPJ</label>
                <input type="text" id="inForn" class="form-control" placeholder="Ex: Nome da Empresa">
            </div>
            <div class="col-md-3">
                <label class="filter-label">Nome do √ìrg√£o</label>
                <input type="text" id="inOrg" class="form-control" placeholder="Ex: Fundo Municipal">
            </div>
            <div class="col-md-2">
                <label class="filter-label">C√≥d. UASG</label>
                <input type="text" id="inUasg" class="form-control" placeholder="Ex: 926150">
            </div>
            <div class="col-md-2">
                <label class="filter-label">Licita√ß√£o (UASG+N¬∫+Ano)</label>
                <input type="text" id="inLic" class="form-control" placeholder="Ex: 926150901402025">
            </div>
            <div class="col-md-2 d-flex gap-2">
                <button onclick="buscar()" class="btn btn-search text-white w-100">Pesquisar</button>
                <button onclick="limpar()" class="btn btn-outline-secondary">Limpar</button>
            </div>
        </div>

        <div id="wrapperResultados" style="display: none;">
            <div class="table-responsive">
                <table class="table table-hover border table-res">
                    <thead class="table-light">
                        <tr>
                            <th>Data</th>
                            <th>UASG</th>
                            <th>√ìrg√£o</th>
                            <th>Licita√ß√£o (ComprasNet)</th>
                            <th>Fornecedor</th>
                            <th class="text-center">Itens</th>
                            <th>Total (R$)</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabela"></tbody>
                </table>
            </div>
            <div id="contador" class="mt-2 small text-muted"></div>
        </div>

        <div id="avisoInicial" class="empty-state">
            <h5>Nenhum filtro aplicado</h5>
            <p>Utilize os campos acima para pesquisar preg√µes espec√≠ficos.</p>
        </div>
    </div>

    <script>
        let db = [];
        // Carrega dados e evita cache
        fetch('dados.json?v=' + Date.now())
            .then(res => res.json())
            .then(data => { db = data; })
            .catch(() => console.error("Base de dados n√£o encontrada."));

        function buscar() {
            const fF = document.getElementById('inForn').value.toLowerCase().trim();
            const fO = document.getElementById('inOrg').value.toLowerCase().trim();
            const fU = document.getElementById('inUasg').value.trim();
            const fL = document.getElementById('inLic').value.trim();

            if(!fF && !fO && !fU && !fL) {
                alert("Preencha ao menos um campo!");
                return;
            }

            const r = db.filter(i => {
                return ( (i.Fornecedor || '').toLowerCase().includes(fF) || (i.CNPJ || '').includes(fF) ) &&
                       ( (i.Orgao || '').toLowerCase().includes(fO) ) &&
                       ( (i.UASG || '').includes(fU) ) &&
                       ( (i.Licitacao || '').includes(fL) );
            });

            const wrap = document.getElementById('wrapperResultados');
            const aviso = document.getElementById('avisoInicial');
            const tbody = document.getElementById('corpoTabela');
            
            aviso.style.display = 'none';
            wrap.style.display = 'block';

            if(r.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center p-5">Nenhum dado encontrado para essa busca.</td></tr>';
                document.getElementById('contador').innerText = "";
            } else {
                tbody.innerHTML = r.reverse().map(i => `
                    <tr>
                        <td>${formatarData(i.Data)}</td>
                        <td class="fw-bold text-muted">${i.UASG || ''}</td>
                        <td>${i.Orgao || ''}</td>
                        <td class="text-primary fw-bold">${i.Licitacao || ''}</td>
                        <td><b>${i.Fornecedor || ''}</b><br><small class="text-muted">${i.CNPJ || ''}</small></td>
                        <td class="text-center">${i.Itens || '0'}</td>
                        <td class="text-success fw-bold">R$ ${Number(i.Total).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    </tr>
                `).join('');
                document.getElementById('contador').innerText = `Mostrando ${r.length} registro(s).`;
            }
        }

        function limpar() {
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.getElementById('wrapperResultados').style.display = 'none';
            document.getElementById('avisoInicial').style.display = 'block';
        }

        function formatarData(d) {
            if (!d || d.length !== 8) return d;
            return d.slice(6,8) + '/' + d.slice(4,6) + '/' + d.slice(0,4);
        }
    </script>
</body>
</html>
