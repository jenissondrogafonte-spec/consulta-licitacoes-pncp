<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Licita√ß√µes - PNCP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .valor-alto { color: #198754; font-weight: bold; } /* Verde para dinheiro */
        .loading { text-align: center; margin-top: 20px; font-style: italic; color: #666; }
    </style>
</head>
<body class="bg-light">

    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">üìä Resultados de Licita√ß√µes (PNCP)</h3>
                <small>Dados coletados automaticamente do Governo Federal</small>
            </div>
            <div class="card-body">
                
                <input type="text" id="campoBusca" class="form-control mb-4 p-3" placeholder="üîé Digite o nome do Fornecedor, √ìrg√£o ou CNPJ...">

                <div class="table-responsive">
                    <table class="table table-hover table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Data</th>
                                <th>√ìrg√£o P√∫blico</th>
                                <th>Licita√ß√£o</th>
                                <th>Fornecedor Vencedor</th>
                                <th>Itens</th>
                                <th>Total Ganho (R$)</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaDados">
                            </tbody>
                    </table>
                    <p id="avisoCarregando" class="loading">Carregando dados, aguarde...</p>
                </div>
            </div>
            <div class="card-footer text-muted text-center">
                Atualizado automaticamente via GitHub Actions
            </div>
        </div>
    </div>

    <script>
        // URL do arquivo JSON (Local)
        const urlDados = 'dados.json'; 

        fetch(urlDados)
            .then(response => {
                if (!response.ok) throw new Error("Arquivo de dados n√£o encontrado");
                return response.json();
            })
            .then(data => {
                // Esconde aviso de carregando
                document.getElementById('avisoCarregando').style.display = 'none';
                
                const tbody = document.getElementById('tabelaDados');
                const input = document.getElementById('campoBusca');

                // Fun√ß√£o que desenha a tabela
                function desenharTabela(lista) {
                    tbody.innerHTML = '';
                    
                    if (lista.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum resultado encontrado.</td></tr>';
                        return;
                    }

                    lista.forEach(linha => {
                        // Formata moeda
                        const valorFormatado = linha['Total_Ganho_R$'].toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                        
                        // Cria a linha HTML
                        const htmlLinha = `
                            <tr>
                                <td>${linha.Data_Homologacao}</td>
                                <td><small>${linha.Orgao_Codigo}</small></td>
                                <td>${linha.Num_Licitacao}</td>
                                <td>
                                    <strong>${linha.Fornecedor}</strong><br>
                                    <small class="text-muted">${linha.CNPJ_Fornecedor || ''}</small>
                                </td>
                                <td class="text-center">${linha.Itens_Ganhos}</td>
                                <td class="valor-alto">${valorFormatado}</td>
                            </tr>
                        `;
                        tbody.innerHTML += htmlLinha;
                    });
                }

                // Desenha inicial (Inverte para mostrar os mais novos primeiro)
                desenharTabela(data.reverse());

                // L√≥gica da Pesquisa
                input.addEventListener('keyup', (e) => {
                    const termo = e.target.value.toLowerCase();
                    const filtrados = data.filter(item => 
                        (item.Fornecedor && item.Fornecedor.toLowerCase().includes(termo)) || 
                        (item.CNPJ_Fornecedor && item.CNPJ_Fornecedor.includes(termo)) ||
                        (item.Orgao_Codigo && item.Orgao_Codigo.toLowerCase().includes(termo))
                    );
                    desenharTabela(filtrados);
                });
            })
            .catch(erro => {
                document.getElementById('avisoCarregando').innerHTML = `<span class="text-danger">Erro ao carregar dados: ${erro.message}. <br>O rob√¥ j√° rodou hoje?</span>`;
            });
    </script>

</body>
</html>
